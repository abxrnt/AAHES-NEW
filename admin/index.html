<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>AAHES | Admin Panel (Single Page)</title>

<!-- Tailwind -->
<script src="https://cdn.tailwindcss.com"></script>

<!-- Poppins font -->
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">

<!-- Font Awesome -->
<script src="https://kit.fontawesome.com/a2e0ef7f4b.js" crossorigin="anonymous"></script>

<style>
:root{
  --bg:#0f172a;
  --card:#111827;
  --muted:#94a3b8;
  --accent:#10b981;
}
html,body { height:100%; }
body{
  font-family: 'Poppins', sans-serif;
  background: linear-gradient(135deg, var(--bg), #000);
  color: #e5e7eb;
  margin:0;
  -webkit-font-smoothing:antialiased;
  -moz-osx-font-smoothing:grayscale;
}
input, textarea, select {
  background-color: #0f172a;
  color: #e2e8f0;
  border: 1px solid #334155;
  transition: all 0.12s ease;
}
input:focus, textarea:focus, select:focus {
  border-color: var(--accent);
  box-shadow: 0 0 0 4px rgba(16,185,129,0.08);
  outline: none;
}
table { width: 100%; border-collapse: collapse; }
th, td { padding: 8px 10px; font-size: 13px; border-bottom: 1px solid #172033; text-align: left; }
thead th { background: #071025; color: var(--accent); position: sticky; top: 0; z-index:1; }
tr:hover td { background: rgba(255,255,255,0.01); }
.modal-backdrop { background: rgba(1,6,12,0.6); position: fixed; inset: 0; display:flex; align-items:center; justify-content:center; z-index: 60; }
.modal-card { width:760px; max-width: calc(100% - 40px); }
.hidden-el { display:none; }
.nav-tab { cursor: pointer; }
.nav-tab.active { background: rgba(255,255,255,0.02); border-bottom: 2px solid var(--accent); }
@media (max-width:920px){
  .two-col { flex-direction:column; gap:12px; }
  #uploadForm { grid-template-columns: 1fr; }
}
</style>
</head>
<body>

<!-- NAV -->
<header class="w-full bg-gray-900 border-b border-gray-700 py-3 px-6 flex items-center justify-between">
<div class="flex items-center gap-4">
<h1 class="text-xl font-bold text-emerald-400">AAHES Admin Panel</h1>
<nav id="mainTabs" class="ml-6 flex items-center gap-2">
<button id="tabDataEntry" class="nav-tab px-3 py-1.5 rounded-lg bg-gray-800 text-sm text-white hover:bg-gray-700 transition hidden">
  <i class="fa-solid fa-pen-to-square mr-1"></i> Data Entry
</button>
<button id="tabDatabase" class="nav-tab px-3 py-1.5 rounded-lg bg-gray-800 text-sm text-white hover:bg-gray-700 transition hidden">
  <i class="fa-solid fa-table mr-1"></i> Database
</button>
<button id="tabRoles" class="nav-tab px-3 py-1.5 rounded-lg bg-gray-800 text-sm text-white hover:bg-gray-700 transition hidden">
  <i class="fa-solid fa-users-gear mr-1"></i> Settings
</button>
</nav>
</div>

<div class="flex items-center gap-4">
  <!-- LOGIN FORM -->
  <form id="loginForm" class="flex items-center gap-2">
    <input type="email" id="emailInput" placeholder="Email" class="p-2 rounded-lg bg-gray-800 text-sm" required>
    <input type="password" id="passwordInput" placeholder="Password" class="p-2 rounded-lg bg-gray-800 text-sm" required>
    <button type="submit" id="loginBtn" class="bg-emerald-600 text-white px-4 py-2 rounded-lg text-sm hover:bg-emerald-700 transition">
      Login
    </button>
  </form>

  <!-- GOOGLE LOGIN -->
  <button id="googleLoginBtn" class="bg-blue-600 text-white px-4 py-2 rounded-lg text-sm hover:bg-blue-700 transition flex items-center gap-2">
    <i class="fa-brands fa-google"></i> Sign in with Google
  </button>

  <div id="userSection" class="hidden items-center gap-3">
    <p class="text-xs text-gray-300">Logged in as <span id="userEmail" class="text-emerald-400 font-medium"></span></p>
    <button id="logoutBtn" class="bg-gray-700 text-white px-3 py-1.5 rounded-lg text-sm hover:bg-gray-600 transition">
      <i class="fa-solid fa-right-from-bracket mr-1"></i> Logout
    </button>
  </div>
</div>
</header>

<!-- Container (Data Entry / Database / Roles sections as in your original code) -->
<div class="px-6 py-6 max-w-7xl mx-auto">
  <!-- Copy your existing Data Entry / Database / Roles sections here -->
</div>

<!-- FOOTER -->
<footer class="py-3 text-center text-gray-400 text-xs">
  Â© 2025 AAHES Admin Panel
</footer>

<!-- FIREBASE + APP LOGIC -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
import {
  getFirestore, collection, addDoc, getDocs, onSnapshot,
  doc, updateDoc, deleteDoc, query, where
} from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

import {
  getAuth, GoogleAuthProvider, signInWithPopup, signOut
} from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";

// -------------------------------
// Firebase config
// -------------------------------
const firebaseConfig = {
  apiKey: "AIzaSyBOVl1hdmprJXpgdN_sNTO3FsNePD_zNZY",
  authDomain: "aahes-cee-cutoffs.firebaseapp.com",
  databaseURL: "https://aahes-cee-cutoffs-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "aahes-cee-cutoffs",
  storageBucket: "aahes-cee-cutoffs.firebasestorage.app",
  messagingSenderId: "706066626405",
  appId: "1:706066626405:web:0d254ab82beb288108938c"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);

// -------------------------------
// Elements
// -------------------------------
const loginForm = document.getElementById('loginForm');
const emailInput = document.getElementById('emailInput');
const passwordInput = document.getElementById('passwordInput');
const googleLoginBtn = document.getElementById('googleLoginBtn');
const userSection = document.getElementById('userSection');
const userEmail = document.getElementById('userEmail');
const logoutBtn = document.getElementById('logoutBtn');

const tabDataEntry = document.getElementById('tabDataEntry');
const tabDatabase = document.getElementById('tabDatabase');
const tabRoles = document.getElementById('tabRoles');

// -------------------------------
// State
// -------------------------------
let currentUserEmail = null;
let currentUserRole = null;
let currentUserName = null;

// -------------------------------
// Helper
// -------------------------------
function esc(s){ if(s===undefined||s===null) return ''; return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }
function show(el){ el.classList.remove('hidden-el'); }
function hide(el){ if(!el.classList.contains('hidden-el')) el.classList.add('hidden-el'); }
function setActiveTab(tabBtn){
  [tabDataEntry, tabDatabase, tabRoles].forEach(b=>b.classList.remove('active'));
  tabBtn.classList.add('active');
}
function applyRolePermissions(){
  // your role-based enabling/disabling code here as in original script
}

// -------------------------------
// Login with email/password
// -------------------------------
loginForm.addEventListener('submit', async (e)=>{
  e.preventDefault();
  const email = (emailInput.value||'').trim().toLowerCase();
  const password = (passwordInput.value||'').trim();
  if(!email||!password){ alert('Enter email & password'); return; }
  try{
    const q = query(collection(db,'admins'), where('email','==',email), where('password','==',password));
    const snap = await getDocs(q);
    if(snap.empty){ alert('Invalid credentials.'); return; }
    const data = snap.docs[0].data();
    currentUserEmail = data.email.toLowerCase();
    currentUserRole = data.role || 'viewer';
    currentUserName = data.name || currentUserEmail;
    loginSuccessUI();
  }catch(err){ console.error(err); alert('Login error:'+err.message); }
});

// -------------------------------
// Login with Google
// -------------------------------
googleLoginBtn.addEventListener('click', async ()=>{
  const provider = new GoogleAuthProvider();
  try{
    const result = await signInWithPopup(auth, provider);
    const user = result.user;
    const email = (user.email||'').toLowerCase();
    // Check if email exists in admins collection
    const q = query(collection(db,'admins'), where('email','==',email));
    const snap = await getDocs(q);
    if(snap.empty){ alert('Access denied: not an admin.'); await signOut(auth); return; }
    const data = snap.docs[0].data();
    currentUserEmail = data.email.toLowerCase();
    currentUserRole = data.role || 'viewer';
    currentUserName = data.name || currentUserEmail;
    loginSuccessUI();
  }catch(err){ console.error(err); alert('Google login failed:'+err.message); }
});

function loginSuccessUI(){
  userEmail.textContent = `${currentUserName} (${currentUserRole})`;
  loginForm.classList.add('hidden');
  googleLoginBtn.classList.add('hidden');
  userSection.classList.remove('hidden');
  tabDataEntry.classList.remove('hidden'); tabDatabase.classList.remove('hidden'); tabRoles.classList.remove('hidden');
  setActiveTab(tabDataEntry);
  show(document.getElementById('dataEntrySection'));
  applyRolePermissions();
}

// -------------------------------
// Logout
// -------------------------------
logoutBtn.addEventListener('click', async ()=>{
  try{ await signOut(auth); }catch{}
  window.location.reload();
});
</script>
</body>
</html>
